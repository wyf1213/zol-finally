"use strict";requirejs.config({baseUrl:"./js",urlArgs:"va="+(new Date).getTime(),paths:{jquery:["./lib/jquery-1.11.1.min"],"jquery.cookie":["./lib/jquery.cookie"],showUname:["./showUname"],cartNums:["./cartNums"]}}),requirejs(["jquery","jquery.cookie","showUname","cartNums"],function(l,t,n,p){l(function(){n.show(),p.getNum();var o=JSON.parse(sessionStorage.getItem("login"));if(null!=o){var t=o.uid;l.ajax({url:"./../server/cartList.php",type:"post",dataType:"json",data:{uId:t}}).then(function(t){0<t.cartnum?t.data.forEach(function(t,e){var n="\n                        <tr data-info='"+JSON.stringify(t)+'\'>\n                            <td colspan="2" class="s-infor clear">\n                                <input type="checkbox">\n                                <a href="details.html?gId='+t.gId+'" class="pic">\n                                    <img src="'+t.gImg+'" alt="">\n                                </a>\n                                <div class="inforbox">\n                                    <h3 class="tit">\n                                        <a href="details.html?gId='+t.gId+'">'+t.gName+"</a>\n                                    </h3>\n                                    <p>内存："+t.gMemory+"</p>\n                                    <p>颜色："+t.gColor+'</p>\n                                    <div class="info-con">\n                                        <span>套装：'+t.gSuit+'</span>\n                                    </div>\n                                </div>\n                            </td>\n                            <td class="s-price ">\n                                <em>'+t.gPrice+'</em>\n                            </td>\n                            <td class="s-amount">\n                                <div class="buy-num">\n                                    <a class="minus" href="#" title="减一">-</a>\n                                    <input type="text" autocomplete="off" class="text-amount" value="'+t.gNum+'">\n                                    <a class="plus" href="#" title="加一">+</a>\n                                </div>\n                            </td>\n                            <td class="s-agio">\n                                <div>&minus;&minus;</div>\n                            </td>\n                            <td class="s-total">\n                                <em>'+t.gTotal+'</em>\n                            </td>\n                            <td class="s-del">\n                                <div class="s-delbox"> \n                                    <a href="javascript:void(0)">删除</a>\n                                    <div class="deletebox">\n                                        <p>确认要删除该商品吗？</p>\n                                        <a href="#" id="yesDelete">是的</a>\n                                        <a href="#" id="noDelete">取消</a> \n                                        <i></i>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                        ';l("#tab").append(n)}):l(".cart").html("<p style='text-align: center;height: 200px;line-height: 200px'>您还没有加购任何商品哦!赶紧<a href='index.html'>购物</a>去吧！</p>")})}else{var e=JSON.parse(l.cookie("cartInfo")||"[]");console.log(e),0<e.length?e.forEach(function(t,e){var n="\n                    <tr data-info='"+JSON.stringify(t)+'\'>\n                        <td colspan="2" class="s-infor clear">\n                            <input type="checkbox" id="cbbox">\n                            <a href="details.html?gId='+t.gId+'" class="pic">\n                                <img src="'+t.gImg+'" alt="">\n                            </a>\n                            <div class="inforbox">\n                                <h3 class="tit">\n                                    <a href="details.html?gId='+t.gId+'">'+t.gName+"</a>\n                                </h3>\n                                <p>内存："+t.gMemory+"</p>\n                                <p>颜色："+t.gColor+'</p>\n                                <div class="info-con">\n                                    <span>套装：'+t.gSuit+'</span>\n                                </div>\n                            </div>\n                        </td>\n                        <td class="s-price ">\n                            <em>'+t.gPrice+'</em>\n                        </td>\n                        <td class="s-amount">\n                            <div class="buy-num">\n                                <a class="minus" href="#" title="减一">-</a>\n                                <input type="text" autocomplete="off" class="text-amount" value="'+t.gNum+'">\n                                <a class="plus" href="#" title="加一">+</a>\n                            </div>\n                        </td>\n                        <td class="s-agio">\n                            <div>&minus;&minus;</div>\n                        </td>\n                        <td class="s-total">\n                            <em>'+t.gPrice*t.gNum+'</em>\n                        </td>\n                        <td class="s-del">\n                            <div class="s-delbox"> \n                                <a href="javascript:void(0)">删除</a>\n                                <div class="deletebox">\n                                    <p>确认要删除该商品吗？</p>\n                                    <a href="#" id="yesDelete">是的</a>\n                                    <a href="#" id="noDelete">取消</a> \n                                    <i></i>\n                                </div>\n                            </div>\n                        </td>\n                    </tr>\n                    ';l("#tab").append(n)}):l(".cart").html("<p style='text-align: center;height: 200px;line-height: 200px'>您还没有加购任何商品哦!赶紧<a href='index.html'>购物</a>去吧！</p>")}function r(){if(0<l("tbody tr .s-infor input:checked").length){var t=l("tbody tr .s-infor input:checked").parents("td"),a=[];if(t.each(function(t,e){var n=parseInt(l(e).siblings("td").eq(3).children("em").text());a.push(n)}),0<a.length)var e=a.reduce(function(t,e){return t+e});l(".total-cart-price").text(e)}else l(".total-cart-price").text(0)}function i(t){l.ajax({url:"./../server/cart.php",type:"post",dataType:"json",data:t}).then(function(t){console.log("修改成功")})}function s(t,e){var n=JSON.parse(l.cookie("cartInfo")||"[]");n[t].gNum=parseInt(n[t].gNum)+e.gNum,l.cookie("cartInfo",JSON.stringify(n),{expires:7})}function c(){0==l("tbody tr .s-infor input").length&&(l(".total-cart-price").text(0),l(".cart").html("<p style='text-align: center;height: 200px;line-height: 200px'>您还没有加购任何商品哦!赶紧<a href='index.html'>购物</a>去吧！</p>"))}r(),l("body").on("click","#tab .minus",function(){if(1<l(this).siblings(".text-amount").val()){var t=l(this).parents("tr").index();console.log(parseInt(l(this).siblings("input").val())),l(this).siblings(".text-amount").val(parseInt(l(this).siblings("input").val())-1);var e=parseInt(l(this).parents("td").siblings("td").eq(1).text().trim()),n=parseInt(l(this).siblings("input").val());l(this).parents("td").siblings("td").eq(3).children("em").text(e*n);var a=JSON.parse(l(this).parents("tr").attr("data-info"));a.gNum=-1,r(),null!=o?i(a):s(t,a)}return!1}),l("body").on("click","#tab .plus",function(){var t=l(this).parents("tr").index();l(this).siblings("input").val(parseInt(l(this).siblings("input").val())+1);var e=parseInt(l(this).parents("td").siblings("td").eq(1).text().trim()),n=parseInt(l(this).siblings("input").val());l(this).parents("td").siblings("td").eq(3).children("em").text(e*n);var a=JSON.parse(l(this).parents("tr").attr("data-info"));return a.gNum=1,r(),null!=o?i(a):s(t,a),!1}),l("body").on("change","tbody tr .s-infor input",function(){r();var t=l("tbody tr").length,e=l("tbody tr .s-infor input:checked").length;return l("#allCbk").prop("checked",t==e),!1}),l("body").on("click",".s-delbox a",function(){var i=l(this).index();return l(this).siblings(".deletebox").show(),l(".order-table").on("click","#yesDelete",function(){l(this).parents(".deletebox").hide(),p.getNum();var t=JSON.parse(l(this).parents("tr").attr("data-info")),a=0;l(".order-table tbody tr .s-infor input").each(function(t,e){if(l(e).eq(i).prop("checked")){var n=parseInt(l(e).parents("tr").children("td.s-total").text().trim());a+=n}});var e=parseInt(l(".total-price .total-cart-price").text().trim())-a;if(l(".total-cart-price").text(e),null!=o)l.ajax({url:"./../server/deleteCart.php",type:"post",data:{cId:t.cId},dataType:"json"}).then(function(t){1==t.status&&(l(this).parents("tr").remove(),console.log(l("tbody tr .s-infor input:checked")))}),l(this).parents("tr").remove(),p.getNum(),c();else{var n=l(this).parents("tr").index(),r=JSON.parse(l.cookie("cartInfo")||"[]");r.splice(n,1),l(this).parents("tr").remove(),l.cookie("cartInfo",JSON.stringify(r),{expires:7}),p.getNum(),c()}return!1}),l(".order-table").on("click","#noDelete",function(){return l(this).parents(".deletebox").hide(),!1}),!1}),l(".order-foot #volumeDelete").on("click",function(){if(0!=l("tbody tr .s-infor input:checked").length){if(confirm("确定要删除所选择的商品吗？")){if(null!=o){var r=[],i=0;l(".order-table tbody tr .s-infor input").each(function(t,e){if(l(e).prop("checked")){var n=JSON.parse(l(e).parents("tr").attr("data-info")).cId,a=parseInt(l(e).parents("tr").children("td.s-total").text().trim());i+=a,r.push(n),l(e).parents("tr").remove()}});var t=parseInt(l(".total-price .total-cart-price").text().trim())-i;l(".total-cart-price").text(t),console.log(r),r.forEach(function(t,e){l.ajax({url:"./../server/deleteCart.php",type:"post",data:{cId:t},dataType:"json"}).then(function(t){console.log(t)})})}else{var a=[],s=[];l(".order-table tbody tr .s-infor input").each(function(t,e){l(e).prop("checked")&&(a.push(t),s.push(parseInt(l(e).parents("tr").children("td.s-total").text().trim())));var n=JSON.parse(l.cookie("cartInfo")||"[]");a.forEach(function(t,e){n.splice(t,1),l("#tab tr").eq(t).remove()}),l.cookie("cartInfo",JSON.stringify(n),{expires:7})}),console.log(s);var e=s.reduce(function(t,e){return t+e});console.log(e);t=parseInt(l(".total-price .total-cart-price").text().trim())-e;l(".total-cart-price").text(t)}c(),p.getNum()}}else alert("您没有选中任何商品");return!1}),l("#allCbk").on("change",function(){var n=l(this);return l("tbody tr .s-infor input").each(function(t,e){l(e).prop("checked",n.prop("checked"))}),r(),!1})})});